<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="css/css.css">
        <link rel="stylesheet" href="dijit/themes/claro/claro.css">
        <script>dojoConfig = {parseOnLoad: true, async: true}</script>
        <script src="dojo/dojo.js"></script>
        <script>
            
            require([
                "dojo/_base/declare", "dojo/parser", "dojo/ready",
                "dijit/_WidgetBase", "dijit/_TemplatedMixin",
                "dijit/_WidgetsInTemplateMixin", "dijit/registry", "dojo/dom", "dojo/dom-construct", "dojo/query", "dojo/text! myApp/templates/formWidget.html", "dijit/Fieldset", "dijit/form/Form", "dijit/form/TextBox",  "dijit/form/Textarea", "dijit/form/ComboBox", "dijit/form/ValidationTextBox", "dojox/validate/web", "dijit/form/Button", "dijit/form/CheckBox", "dijit/Dialog"
            ], function(declare, parser, ready, _WidgetBase, _TemplatedMixin,
            _WidgetsInTemplateMixin, registry, dom, domConstruct, query, template){

                declare("form", [_WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin], { 
                    templateString: template,

                    reset: function(){
                        var f = document.getElementById("myForm");
                        return confirm('Press OK to reset widget values');
                    },

                    valid: function(){
                        var ps = query("form label p");
                        for (var i = 0; i < ps.length; i++) {
                            domConstruct.destroy(ps[i]);
                        };
                        var form = dom.byId("myForm");
                        var val = false;
                        var f = document.getElementById("myForm");
                        if(f.email.value ==""||f.firstName.value == ""||f.lastName.value == ""|| f.company.value == ""||f.address.value == ""||f.phone.value ==""){
                            val = false;
                        }else{
                           if(this.emailNode.isValid()&&this.phoneNode.isValid()){
                                val = true;
                            }else{
                                alert('Form contains invalid data.  Please correct first');
                                return false;
                            }
                        }
                        if(val){
                                var inputs = query("form [name]");
                                var values = [];
                                var cont = 0;
                                var paymentMode = "";
                                for (var i = 0; i < inputs.length; i++) {
                                    if(i > 9 && i < 13){
                                        if(inputs[i].checked){
                                            if(paymentMode != "")
                                                paymentMode +=", ";
                                            paymentMode = paymentMode + inputs[i].value;
                                        }else{
                                            
                                        }
                                        if(i==12){
                                            values[cont] = paymentMode;
                                            cont++;
                                        }
                                    }else{
                                        values[cont] = inputs[i].value;
                                        cont++;
                                    }
                                };
                                var div = query("#content div")[0];
                                domConstruct.destroy(div);
                                var content = dom.byId("content");
                                div = domConstruct.create("div",{innerHTML: ""}, content);
                                var labels = query("form label");
                                cont = 0;
                                for (var i = 0; i < labels.length; i++) {
                                    var label = labels[i].innerHTML;
                                    if(label != "Cash" && label != "Cheque" && label != "Demand Draft"){

                                        var ks =domConstruct.create("strong",{
                                            innerHTML: label+":"}, div
                                        );
                                        var p = domConstruct.create("p",{innerHTML: values[cont]+".</br>"}, ks, "after");
                                        cont++;
                                    }
                                };
                            var dialog = registry.byId("myConfirmDialog").show();
                        }else{
                            var rojos = query("form label.required");
                            for (var i = 0; i < rojos.length; i++) {
                                domConstruct.create("p", {
                                    innerHTML: "*",
                                    style: {
                                        color: "#ff0000"
                                    }
                                }, rojos[i]);
                            }
                            alert('All the elements with the * in red are required');
                            return false;
                        }
                        return true;
                    },

                    postCreate: function(){
                        
                        var legendspan = query("legend .dijitInline.dijitArrowNode");
                        var legend1 = query("#othersfields legend")[0];
                        var legend2 = query("#bottom legend")[0];
                        domConstruct.destroy(legend1);
                        domConstruct.destroy(legend2);
                        for (var i = 0; i < legendspan.length; i++) {
                            domConstruct.destroy(legendspan[i])
                        };
                    }
                    
                });
                ready(function(){
                    parser.parse();
                });
            });
        </script>
    </head>
    <body class="claro">
        <div data-dojo-type="dijit/Dialog" id="myConfirmDialog" data-dojo-id="myConfirmDialog" title="Confirm Dialog" style="display: none">
            <div id="content" class="dijitDialogPaneContentArea">
                
            </div>
            <div class="dijitDialogPaneActionBar">
                <button data-dojo-type="dijit/form/Button" type="button">OK
                    <script type="dojo/method" data-dojo-event="onClick" data-dojo-args="evt">
                        require(["dojo/dom", "dojo/dom-construct"], function(dom, domConstruct){
                            myConfirmDialog.hide();
                            var form = dom.byId("myForm");
                            form.submit();
                        });
                    </script>
                </button>
                <button data-dojo-type="dijit/form/Button" type="button">Cancel
                    <script type="dojo/method" data-dojo-event="onClick" data-dojo-args="evt">
                        myConfirmDialog.hide();
                    </script>
                </button>
            </div>
        </div>
        <div id="containerDiv">
        	<div id="header">
                <div id="title">
                     <b>Workshop Registration</b>
                </div>
                <div id="actionsDiv">
                    <ul id="actions"><span>More Actions</span>
                        
                    </ul>
                </div>
            </div>
                <span data-dojo-type="form"></span>
        </div>
 	</body>

</html>